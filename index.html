<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2ì°¨ì‹œ | ì˜ìƒ íƒì •ë‹¨ì˜ ì›€ì§ì´ëŠ” ë¹„ë°€: ì§„ì§œê°€ ê¶ê¸ˆí•´ìš”</title>
<style>
  :root{
    --bg:#e6f2ff;--panel:#ffffffee;--muted:#64748b;--text:#1f2937;
    --accent:#247cff;--accent2:#3c92fb;--good:#16a34a;--bad:#ef4444;
    --ring:#0b65f5;--soft:#f8fafc;--border:#e5e7eb;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);
      color:var(--text);font:16px/1.5 system-ui,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif}
  .max{max-width:1100px;margin:0 auto;padding:20px;display:flex;flex-direction:column;height:100%}
  .card{background:var(--panel);backdrop-filter:blur(8px);border:1px solid var(--border);
        border-radius:18px;box-shadow:0 8px 24px #00000010}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .grow{flex:1}
  .headline{font-size:clamp(22px,3.2vw,30px);font-weight:900;margin:0}
  .sub{color:var(--muted);font-size:14px}
  .btn, .ghost, .pill{appearance:none;border:0;border-radius:18px;padding:10px 18px;font-size:18px;font-weight:800;cursor:pointer}
  header{margin-bottom:16px;flex-shrink:0}
  .btn{color:#fff;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 18px #247cff33}
  .ghost{background:#fff;color:var(--text);border:1px solid var(--border)}
  .pill{background:var(--soft);color:var(--muted);font-size:14px;padding:6px 12px;font-weight:600;display:inline-flex;align-items:center;gap:4px;}

  label{font-size:18px; cursor: pointer;}
  .screen{padding:22px}
  .screens-wrapper{flex-grow:1;min-height:0;display:flex;flex-direction:column}
  .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
  .thumb{position:relative;border-radius:16px;overflow:hidden;border:1px solid var(--border);background:#fff;display:flex;flex-direction:column}
 .thumb video{width:100%;height:auto;object-fit:contain;display:block; background:#000;}
  .thumb .ghost{position:absolute;right:12px;bottom:12px;padding:14px 18px;font-size:18px}
  .stage{position:relative;border-radius:18px;overflow:hidden;border:1px solid var(--border);background:var(--soft)}
  .stage video{width:100%;height:100%;display:block; background:#000;}

  #screen-start[hidden], #screen-play[hidden]{display:none !important}
  #screen-play:not([hidden]){display:flex;flex-direction:column;flex-grow:1}
  #screen-play:not([hidden]) .stage{flex-grow:1;min-height:0}

  .hotspot{position:absolute;border:3px dashed var(--ring);border-radius:999px;transform:translate(-50%,-50%);
          width:72px;height:72px;pointer-events:none;opacity:0;transition:.25s}
  .hotspot.found{border-color:var(--good);box-shadow:0 0 0 6px #16a34a33}
  .ping{position:absolute;inset:0;border-radius:inherit;border:3px solid transparent;animation:ping 1.1s ease-out 2}
  @keyframes ping{0%{box-shadow:0 0 0 0 #0b65f555}100%{box-shadow:0 0 0 24px transparent}}
  
  .toast{position:fixed;left:50%;bottom:26px;transform:translateX(-50%);
         background:#111827e6;color:#fff;border:1px solid #00000022;padding:12px 16px;
         border-radius:14px;font-size:16px;z-index:9999}
  .captions{position:fixed;left:50%;top:12px;transform:translateX(-50%);
            background:#111827e6;color:#fff;padding:8px 12px;border-radius:12px;font-size:15px;z-index:9999}

  .divider{height:1px;background:var(--border);margin:12px 0}
  .kudos{font-weight:900;background:linear-gradient(135deg,#34d399,var(--accent));-webkit-background-clip:text;background-clip:text;color:transparent}
  
  footer{margin-top:18px;text-align:center;color:#6b7280;font-size:13px;flex-shrink:0}

  #screen-play{flex:1;display:flex;flex-direction:column}
  #screen-play .stage{flex:1;display:flex;align-items:center;justify-content:center;max-height:70vh}
  #screen-play video{max-width:100%;max-height:100%;object-fit:contain}

  @media (max-width:480px){ header.row{justify-content:center} }
</style>
</head>
<body>
<div class="max">
  <header class="row">
    <h1 class="headline">2ì°¨ì‹œ | ì˜ìƒ íƒì •ë‹¨ì˜ ì›€ì§ì´ëŠ” ë¹„ë°€: ì§„ì§œê°€ ê¶ê¸ˆí•´ìš”</h1>
    <span class="pill">ì „ì²´ í•©ê³„: ì°¾ì€ ë‹¨ì„œ <b id="stat-found">0</b> Â· ì „ì²´ ì‚¬ìš© ì‹œê°„ <b id="stat-time">00:00</b></span>
    <span class="grow"></span>
    <button id="btn-audio" class="ghost">ğŸ”ˆ ìŒì„± OFF</button>
  </header>

  <main class="screens-wrapper">
    <section id="screen-start" class="screen card" role="region" aria-label="ì‹œì‘ í™”ë©´">
      <div class="row">
        <h2 style="margin:0">1ë‹¨ê³„ ì˜ìƒ</h2>
        <span class="grow"></span>
        <button id="btn-reset" class="ghost" title="ì§„í–‰ ê¸°ë¡ ì´ˆê¸°í™”">ì²˜ìŒë¶€í„° ë„ì „í•˜ê¸°</button>
      </div>
      
      <div class="grid" id="grid" style="margin-top:16px"></div>

      <p class="sub" id="policy-line" style="margin-top:12px">
        ï¼Š ì´ í™œë™ì€ <b>ì˜ìƒ ì† ì‹¤ì œì™€ ë‹¤ë¥¸ ë‹¨ì„œ</b>ë¥¼ ì°¾ì•„ë³´ë©°,
        <b>ì˜ìƒì´ ì‹¤ì œì™€ ë‹¤ë¥´ê²Œ ë°”ë€” ìˆ˜ ìˆìŒì„ ë°°ìš°ê³  ì„¤ëª…</b>í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.<br>
        ï¼Š ì°¾ì•„ë‚¸ ë‚´ìš©ì„ í†µí•´ ë¹„íŒì ìœ¼ë¡œ ìƒê°í•˜ëŠ” í˜ì„ ê¸°ë¥´ê³ , ë””ì§€í„¸ ìë£Œë¥¼ ì‚¬ìš©í•  ë•ŒëŠ”
        <b>í—ˆë½ë°›ê¸°Â·í™•ì¸í•˜ê¸°Â·ì‹œê°„ ì§€í‚¤ê¸°</b> ì•½ì†ì„ ì‹¤ì²œí•©ë‹ˆë‹¤.<br>
        ï¼Š ì´ ì›¹ì•±ì€ <b>ê°œì¸ ì •ë³´ë¥¼ ìˆ˜ì§‘Â·ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</b><br>
        ï¼Š ê³µìœ í•  ë•Œì—ëŠ” ë°˜ë“œì‹œ <b>ì¶œì²˜ í‘œê¸°ì™€ ì‚¬ì‹¤ í™•ì¸</b>ì„ í•¨ê»˜ ì§€ì¼œì£¼ì„¸ìš”.
      </p>
    </section>

    <section id="screen-play" class="screen card" role="region" aria-label="í”Œë ˆì´ í™”ë©´" hidden>
      <div class="row">
        <h2 id="play-title" style="margin:0">í”Œë ˆì´</h2>
        <span class="grow"></span>
        <button id="btn-exit" class="ghost">â† ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>

      <div class="sub" id="play-caption">ì§„ì§œì™€ ë‹¤ë¥¸ ë¶€ë¶„ì„ ì°¾ì•„ í´ë¦­í•´ìš”!</div>
      <div id="stage" class="stage" tabindex="0" aria-label="ë‹¨ì„œë¥¼ ì°¾ëŠ” ì˜ì—­"></div>
      
      <div class="row" style="margin-top:12px">
        <span class="pill">ì°¾ì€ ë‹¨ì„œ: <b class="found-count">0</b>/<b class="need-count">1</b></span>
        <span class="pill">ì†Œìš” ì‹œê°„: <b id="clock">00:00</b></span>
        <span class="grow"></span>
        <button id="btn-hint" class="ghost">ğŸ’¡ íŒíŠ¸ ë³´ê¸°</button>
      </div>

      <div id="result" hidden>
        <div class="divider"></div>
        <h3 class="kudos">ğŸ‰ ì§„ì§œ ëª¨ìŠµ í™•ì¸ ì™„ë£Œ!</h3>
        <p class="sub" id="summary">AIê°€ ë§Œë“  ì˜ìƒê³¼ ì‹¤ì œ ì˜ìƒì˜ ë‹¤ë¥¸ ì ì„ ë°œê²¬í–ˆì–´ìš”.</p>
        <div id="original" class="stage" style="margin-top:10px"></div>
        <div class="row" style="margin-top:12px">
          <button id="btn-replay" class="btn">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
          <span class="grow"></span>
          <button id="btn-other" class="ghost">ë‹¤ìŒ ë‹¨ê³„ â†’</button>
        </div>
      </div>
    </section>
  </main>

</div>

<div id="captions" class="captions" hidden></div>
<div id="toast" class="toast" role="status" aria-live="polite" hidden></div>

<script>
/* ---------- ìŒì„± & ìë§‰ ---------- */
function showCaption(msg){
  const c = document.getElementById('captions');
  c.textContent = msg; c.hidden = false;
  clearTimeout(showCaption._t);
  showCaption._t = setTimeout(()=> c.hidden = true, 1400);
}
function speak(text){
  if(!GLOBAL.audio){ showCaption(text); return; }
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang='ko-KR'; u.rate=1; u.pitch=1.15;
    const apply=()=>{
      const ko = speechSynthesis.getVoices().find(v=>v.lang.startsWith('ko'));
      if(ko) u.voice = ko;
      speechSynthesis.cancel(); speechSynthesis.speak(u);
    };
    if(!speechSynthesis.getVoices().length){ speechSynthesis.onvoiceschanged = apply; }
    else apply();
  }catch(e){}
  showCaption(text);
}
</script>

<script>
/* -------------------- ì½˜í…ì¸  (ì˜ìƒ ê²½ë¡œ) -------------------- */
const CONTENT = [
  { 
    id: 'vid-1',
    need: 1,
    fake: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4', 
    orig: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4', 
    spots: [{x: 50, y: 50, r: 15}] 
  },
  { 
    id: 'vid-2',
    need: 1,
    fake: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4', 
    orig: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4', 
    spots: [{x: 25, y: 70, r: 10}] 
  },
  { 
    id: 'vid-3',
    need: 2,
    fake: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4', 
    orig: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4', 
    spots: [{x: 75, y: 40, r: 12}, {x: 85, y: 80, r: 8}] 
  },
];
</script>

<script>
/* ---------- ì „ì—­ ìƒíƒœ/ìœ í‹¸ ---------- */
const qs = s => document.querySelector(s);
const qsa = s => [...document.querySelectorAll(s)]; // <<< ì´ ì¤„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!
const $start = qs('#screen-start');
const $play  = qs('#screen-play');
const $grid  = qs('#grid');
const $stage = qs('#stage');
const $original = qs('#original');
const $result   = qs('#result');
const $toast    = qs('#toast');
const $btnAudio = qs('#btn-audio');
const $statFound = qs('#stat-found');
const $statTime  = qs('#stat-time');
const $playTitle = qs('#play-title');
const $playCaption = qs('#play-caption');
const $clock = qs('#clock');
const $foundSpans = qsa('.found-count');
const $needSpans  = qsa('.need-count');


let GLOBAL = { startedAt:0, timerId:null, sessionFound:0, audio:false, dev:false, cleared: false };
let ROUND  = { step:0, item:null, found:new Set(), need:0, lock:false };

let playTimerId = null;
let playStartTime = 0;

const STORAGE_KEY = 'video_cleared_v1';
function loadClears(){ return localStorage.getItem(STORAGE_KEY) === 'true'; }
function saveClears(){ localStorage.setItem(STORAGE_KEY, GLOBAL.cleared); }

function speakToast(msg){ speak(msg); toast(msg); }
function toast(msg){ $toast.textContent=msg; $toast.hidden=false; clearTimeout(toast._t);
  toast._t=setTimeout(()=> $toast.hidden=true, 1400); }

function startOverallTimer(){
  let t0 = sessionStorage.getItem('sessionStartTime');
  if(!t0){ t0=Date.now(); sessionStorage.setItem('sessionStartTime', t0); }
  clearInterval(GLOBAL.timerId);
  GLOBAL.timerId = setInterval(()=>{
    const s=Math.floor((Date.now()-t0)/1000);
    const mm=String(Math.floor(s/60)).padStart(2,'0');
    const ss=String(s%60).padStart(2,'0');
    if($statTime) $statTime.textContent=`${mm}:${ss}`;
  },1000);
}

function startPlayTimer(){
  playStartTime = Date.now();
  clearInterval(playTimerId);
  playTimerId = setInterval(()=>{
    const s = Math.floor((Date.now()-playStartTime)/1000);
    const mm=String(Math.floor(s/60)).padStart(2,'0');
    const ss=String(s%60).padStart(2,'0');
    if($clock) $clock.textContent=`${mm}:${ss}`;
  }, 250);
}

function stopPlayTimer(){
  clearInterval(playTimerId);
  playTimerId = null;
  if($clock) $clock.textContent = '00:00';
}


function navPlay(on){ 
  $start.hidden = on; 
  $play.hidden = !on;
  document.querySelectorAll('video').forEach(v => v.pause());
  if (!on) {
    stopPlayTimer();
  }
}

/* ---------- UI ë¹Œë“œ & ì§„í–‰ ---------- */
$btnAudio.onclick = ()=>{
  GLOBAL.audio = !GLOBAL.audio;
  $btnAudio.textContent = GLOBAL.audio? 'ğŸ”Š ìŒì„± ON' : 'ğŸ”ˆ ìŒì„± OFF';
};

function buildGrid() {
  $grid.innerHTML = '';
  const d = document.createElement('div');
  d.className = 'thumb';
  const isCleared = GLOBAL.cleared;
  const buttonText = isCleared ? `âœ… ëª¨ë“  ë‹¨ê³„ í´ë¦¬ì–´` : `1ë‹¨ê³„ ì‹œì‘`;
  const firstVideo = CONTENT[0];

  d.innerHTML = `
    <video src="${firstVideo.fake}" muted playsinline autoplay loop></video>
    <button class="ghost" ${isCleared ? 'disabled' : ''}>${buttonText}</button>
  `;
  d.querySelector('button').onclick = () => startPlay();
  $grid.appendChild(d);
}

function startPlay(){
  ROUND = { step:0, item:null, found:new Set(), need:0, lock:false };
  playStep();
}

function playStep(){
  const items = CONTENT;
  if(ROUND.step >= items.length){ 
    GLOBAL.cleared = true;
    saveClears();
    navPlay(false);
    buildGrid();
    speakToast('ëª¨ë“  ë‹¨ê³„ë¥¼ ì™„ë£Œí–ˆì–´ìš”! ëŒ€ë‹¨í•´ìš”!');
    return;
  }

  const item = items[ROUND.step];
  ROUND.item = item;
  ROUND.found = new Set();
  ROUND.need = item.need || 1;
  ROUND.lock = false;
  
  $result.hidden = true;
  $foundSpans.forEach(el => el.textContent='0');
  $needSpans.forEach(el => el.textContent=ROUND.need);
  $playTitle.textContent = `ğŸ¬ ${ROUND.step + 1}ë‹¨ê³„ íƒìƒ‰ ì¤‘`;
  $playCaption.textContent = `ì§„ì§œì™€ ë‹¤ë¥¸ ë¶€ë¶„ ${ROUND.need}ê³³ì„ ì°¾ì•„ í´ë¦­í•´ìš”!`;

  $stage.innerHTML = '';
  const video = document.createElement('video');
  video.src = item.fake;
  video.autoplay = true;
  video.loop = true;
  video.muted = true;
  video.playsinline = true;
  $stage.appendChild(video);
  
  video.addEventListener('canplay', () => {
    video.play().catch(error => {
      console.warn("Video autoplay blocked:", error);
      speakToast('ì˜ìƒì„ ë³´ë ¤ë©´ í™”ë©´ì„ í•œ ë²ˆ í´ë¦­í•´ì£¼ì„¸ìš”.');
    });
  });
  video.load();
  
  $stage.onclick = onStageClick;
  qs('#btn-exit').onclick = ()=> navPlay(false);
  qs('#btn-hint').onclick = () => showHint(item);

  startPlayTimer();
  navPlay(true);
  if (ROUND.step === 0) speakToast('í‹€ë¦° ë¶€ë¶„ì„ ì°¾ì•„ í´ë¦­í•´ë³´ì„¸ìš”!');
}


function onStageClick(e) {
  if (ROUND.lock) return;
  const rect = $stage.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width) * 100;
  const y = ((e.clientY - rect.top) / rect.height) * 100;

  if (GLOBAL.dev) {
    console.log(`[ê°œë°œì ëª¨ë“œ] x: ${x.toFixed(1)}, y: ${y.toFixed(1)}`);
  }

  const idx = (ROUND.item.spots || []).findIndex((h,i) => 
    !ROUND.found.has(i) && Math.hypot(x - h.x, y - h.y) <= (h.r || 10) + 5
  );

  if (idx >= 0) {
    ROUND.found.add(idx);
    $foundSpans.forEach(el => el.textContent = ROUND.found.size);
    GLOBAL.sessionFound++; 
    $statFound.textContent = GLOBAL.sessionFound;
    
    ringAt(x,y,true);
    speakToast('ì •ë‹µ! ì˜ ì°¾ì•˜ì–´ìš”');
    
    if(ROUND.found.size >= ROUND.need){ onWin(); }
  } else {
    ringAt(x,y,false);
    speakToast('ê´œì°®ì•„ìš”, ì¡°ê¸ˆ ë” ì‚´í´ë´ìš”');
  }
}

function ringAt(px,py,good){
  const m=document.createElement('div');
  m.className='hotspot'+(good?' found':'');
  m.style.left=px+'%'; m.style.top=py+'%'; m.style.opacity=1;
  m.innerHTML='<span class="ping"></span>';
  $stage.appendChild(m);
  if(!good) setTimeout(()=> m.remove(), 1500);
}

function showHint(item){
  const msg='ì—¬ê¸°ë¥¼ ì¡°ê¸ˆ ë” ì‚´í´ë³¼ê¹Œìš”?'; speakToast(msg);
  const i=(item.spots||[]).findIndex((_,i)=> !ROUND.found.has(i));
  if(i>=0){
    const h=item.spots[i];
    const g=document.createElement('div'); g.className='hotspot';
    g.style.left=h.x+'%'; g.style.top=h.y+'%';
    g.style.width=g.style.height=(h.r*60)+'px';
    g.style.opacity=.75; g.style.borderStyle='solid';
    $stage.appendChild(g); setTimeout(()=> g.remove(),1600);
  }
}

function onWin() {
  ROUND.lock = true;
  stopPlayTimer();
  
  $result.hidden = false;
  $stage.querySelector('video')?.pause();

  $original.innerHTML = '';
  const origVideo = document.createElement('video');
  origVideo.src = ROUND.item.orig;
  origVideo.controls = true;
  origVideo.autoplay = true;
  origVideo.loop = true;
  origVideo.muted = false;
  origVideo.playsinline = true;
  $original.appendChild(origVideo);
  
  const last = ROUND.step >= CONTENT.length - 1;
  const $nextButton = qs('#btn-other');
  $nextButton.textContent = last ? 'í™ˆìœ¼ë¡œ' : 'ë‹¤ìŒ ë‹¨ê³„ â†’';
  $nextButton.onclick = () => {
    if (last) {
      GLOBAL.cleared = true;
      saveClears();
      navPlay(false);
      buildGrid();
    } else {
      ROUND.step++;
      playStep();
    }
  };
  
  qs('#btn-replay').onclick = () => playStep();
  speak(last ? 'ì§„ì§œ ëª¨ìŠµ í™•ì¸ ì™„ë£Œ! ëª¨ë“  ë‹¨ê³„ë¥¼ ë‹¤ ì°¾ì•˜ì–´ìš”!' : 'ì§„ì§œ ëª¨ìŠµ í™•ì¸ ì™„ë£Œ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ê°€ë³¼ê¹Œìš”?');
}

/* ---------- ì´ˆê¸°í™” ---------- */
(function init() {
  GLOBAL.cleared = loadClears();
  buildGrid();
  startOverallTimer();

  let clickCount=0, clickTimer=null;
  qs('.headline').onclick = ()=>{
    clickCount++; clearTimeout(clickTimer);
    clickTimer=setTimeout(()=>clickCount=0,1000);
    if(clickCount>=5){ GLOBAL.dev=true; clickCount=0; toast('âœ¨ ê°œë°œì ëª¨ë“œ ON'); }
  };

  qs('#btn-reset').onclick = ()=>{
    if (confirm('ëª¨ë“  ì§„í–‰ ê¸°ë¡ì„ ì§€ìš°ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë„ì „í• ê¹Œìš”?')) {
      localStorage.removeItem(STORAGE_KEY);
      GLOBAL.cleared = false;
      GLOBAL.sessionFound = 0;
      $statFound.textContent = '0';
      buildGrid();
      speakToast('ì§„í–‰ ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë„ì „í•´ìš”!');
    }
  };
})();
</script>
</body>
</html>
